<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR AR Troubleshooter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #8f44ff;
        }
        .result {
            background-color: #f5f5f5;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        button {
            background-color: #8f44ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #6622cc;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .error {
            color: #721c24;
            background-color: #f8d7da;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>WebXR AR Troubleshooter</h1>
    <p>This tool helps diagnose issues with WebXR AR on your device.</p>
    
    <div class="section">
        <h2>Basic WebXR Support</h2>
        <button id="checkXRSupport">Check WebXR Support</button>
        <div id="xrSupportResult" class="result"></div>
    </div>
    
    <div class="section">
        <h2>AR Session Support</h2>
        <button id="checkARSupport">Check AR Support</button>
        <div id="arSupportResult" class="result"></div>
    </div>
    
    <div class="section">
        <h2>Feature Support</h2>
        <button id="checkFeatures">Check AR Features</button>
        <div id="featuresResult" class="result"></div>
    </div>
    
    <div class="section">
        <h2>Device Information</h2>
        <div id="deviceInfo" class="result"></div>
    </div>
    
    <div class="section">
        <h2>Browser Compatibility</h2>
        <table>
            <tr>
                <th>Browser</th>
                <th>WebXR AR Support</th>
            </tr>
            <tr>
                <td>Chrome for Android (80+)</td>
                <td>Yes</td>
            </tr>
            <tr>
                <td>Samsung Internet (11.2+)</td>
                <td>Yes</td>
            </tr>
            <tr>
                <td>Firefox for Android</td>
                <td>Limited</td>
            </tr>
            <tr>
                <td>Safari for iOS</td>
                <td>No (Use WebXR Viewer app)</td>
            </tr>
            <tr>
                <td>Desktop browsers</td>
                <td>No (except with emulation)</td>
            </tr>
        </table>
    </div>
    
    <div class="section">
        <h2>Recommendations</h2>
        <div id="recommendations"></div>
    </div>
    
    <p><a href="index.html">Return to AR Party Experience</a></p>
    
    <script>
        // Display device information
        const deviceInfo = document.getElementById('deviceInfo');
        deviceInfo.textContent = `
User Agent: ${navigator.userAgent}
Platform: ${navigator.platform}
Vendor: ${navigator.vendor}
Screen Resolution: ${window.screen.width}x${window.screen.height}
Device Pixel Ratio: ${window.devicePixelRatio}
        `;
        
        // Check for WebXR support
        document.getElementById('checkXRSupport').addEventListener('click', function() {
            const result = document.getElementById('xrSupportResult');
            
            if ('xr' in navigator) {
                result.textContent = "✅ WebXR API is supported in this browser";
                result.classList.add('success');
                result.classList.remove('error');
            } else {
                result.textContent = "❌ WebXR API is NOT supported in this browser";
                result.classList.add('error');
                result.classList.remove('success');
                
                // Add recommendations
                document.getElementById('recommendations').innerHTML = `
                    <p>Your browser doesn't support WebXR. Try using:</p>
                    <ul>
                        <li>Chrome for Android (version 80 or higher)</li>
                        <li>Samsung Internet (version 11.2 or higher)</li>
                        <li>For iOS: WebXR Viewer app from the App Store</li>
                    </ul>
                `;
            }
        });
        
        // Check for AR support
        document.getElementById('checkARSupport').addEventListener('click', function() {
            const result = document.getElementById('arSupportResult');
            
            if (!('xr' in navigator)) {
                result.textContent = "❌ Cannot check AR support: WebXR API not available";
                result.classList.add('error');
                result.classList.remove('success');
                return;
            }
            
            navigator.xr.isSessionSupported('immersive-ar')
                .then(supported => {
                    if (supported) {
                        result.textContent = "✅ AR sessions are supported on this device";
                        result.classList.add('success');
                        result.classList.remove('error');
                    } else {
                        result.textContent = "❌ AR sessions are NOT supported on this device";
                        result.classList.add('error');
                        result.classList.remove('success');
                        
                        // Add recommendations
                        document.getElementById('recommendations').innerHTML += `
                            <p>Your device doesn't support AR sessions. Make sure you're using:</p>
                            <ul>
                                <li>An AR-capable Android device with ARCore installed</li>
                                <li>Chrome for Android with AR enabled</li>
                                <li>Or an iOS device with the WebXR Viewer app</li>
                            </ul>
                        `;
                    }
                })
                .catch(error => {
                    result.textContent = `❌ Error checking AR support: ${error.message}`;
                    result.classList.add('error');
                    result.classList.remove('success');
                });
        });
        
        // Check AR features
        document.getElementById('checkFeatures').addEventListener('click', async function() {
            const result = document.getElementById('featuresResult');
            
            if (!('xr' in navigator)) {
                result.textContent = "❌ Cannot check features: WebXR API not available";
                result.classList.add('error');
                result.classList.remove('success');
                return;
            }
            
            try {
                const isARSupported = await navigator.xr.isSessionSupported('immersive-ar');
                
                if (!isARSupported) {
                    result.textContent = "❌ Cannot check features: AR not supported";
                    result.classList.add('error');
                    result.classList.remove('success');
                    return;
                }
                
                // Try to create a temporary session to check features
                try {
                    const session = await navigator.xr.requestSession('immersive-ar', {
                        optionalFeatures: [
                            'hit-test',
                            'dom-overlay',
                            'light-estimation',
                            'anchors',
                            'plane-detection'
                        ]
                    });
                    
                    const supportedFeatures = session.enabledFeatures;
                    
                    let featureStatus = "Supported features:\n";
                    
                    // Check specific features
                    featureStatus += `hit-test: ${supportedFeatures.includes('hit-test') ? '✅' : '❌'}\n`;
                    featureStatus += `dom-overlay: ${supportedFeatures.includes('dom-overlay') ? '✅' : '❌'}\n`;
                    featureStatus += `light-estimation: ${supportedFeatures.includes('light-estimation') ? '✅' : '❌'}\n`;
                    featureStatus += `anchors: ${supportedFeatures.includes('anchors') ? '✅' : '❌'}\n`;
                    featureStatus += `plane-detection: ${supportedFeatures.includes('plane-detection') ? '✅' : '❌'}\n`;
                    
                    // End the session
                    session.end();
                    
                    result.textContent = featureStatus;
                    
                    if (!supportedFeatures.includes('hit-test')) {
                        result.classList.add('error');
                        document.getElementById('recommendations').innerHTML += `
                            <p>Your device doesn't support the hit-test feature which is required for the AR Party app.</p>
                        `;
                    } else {
                        result.classList.add('success');
                    }
                } catch (error) {
                    result.textContent = `❌ Error creating test session: ${error.message}\n\nThis often happens when you try to test AR features outside of an actual user interaction.`;
                    result.classList.add('error');
                    result.classList.remove('success');
                }
            } catch (error) {
                result.textContent = `❌ Error: ${error.message}`;
                result.classList.add('error');
                result.classList.remove('success');
            }
        });
    </script>
</body>
</html>
